<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juegos Educativos | MenTora</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Exo+2:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/news.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/games.css') }}">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

    {% include 'background_usser.html' %}  

    <a href="/dashboard" class="back-button" title="Volver al Dashboard">
        <svg viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
    </a>

    <div class="container">
        <div class="news-header">
            <h1><i data-lucide="gamepad2" style="display: inline; width: 1.2em; height: 1.2em; vertical-align: -0.2em;"></i> Centro de Aprendizaje Interactivo</h1>
            <p>Mejora tus habilidades de programación con juegos educativos divertidos y desafiantes. Completa desafíos, gana XP y domina los conceptos de codificación.</p>
        </div>

        <div class="filters-section">
            <div class="filters-wrapper">
                <div class="filters">
                    <button class="filter-btn active" onclick="showTab('games-tab')">
                        <i data-lucide="joystick"></i>
                        Juegos
                    </button>
                    <button class="filter-btn" onclick="showTab('vr-tab')">
                        <i data-lucide="headphones"></i>
                        Laboratorio VR
                    </button>
                    <button class="filter-btn" onclick="showTab('chat-tab')">
                        <i data-lucide="message-circle"></i>
                        Chat
                    </button>
                </div>
            </div>
        </div>

        <main>
            <!-- Games Tab -->
            <div id="games-tab" class="tab-content active">
                <div id="games-menu">
                    <div class="games-grid">
                        <div class="game-card">
                            <svg class="game-icon" data-lucide="code" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                            <h3>Quiz Programación</h3>
                            <p>10 preguntas • +30 XP</p>
                            <button class="btn-game" onclick="startQuiz()">
                                Jugar
                            </button>
                        </div>

                        <div class="game-card">
                            <svg class="game-icon" data-lucide="repeat2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                            <h3>Memorama de Código</h3>
                            <p>16 cartas • +20 XP</p>
                            <button class="btn-game" onclick="startMemoryGame()">
                                Jugar
                            </button>
                        </div>

                        <div class="game-card">
                            <svg class="game-icon" data-lucide="zap" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                            <h3>Desafío Rápido</h3>
                            <p>Preguntas aleatorias • +15 XP</p>
                            <button class="btn-game" onclick="startQuickChallenge()">
                                Jugar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Juegos y Quizzes Creados por Docentes -->
                <div class="teacher-content-section">
                    <h2 class="teacher-content-title">Juegos y Quizzes de Docentes</h2>
                    <p class="teacher-content-subtitle">Contenido educativo creado por tus profesores</p>
                    
                    <div class="games-grid">
                        {% set hay_juegos = games and games|length > 0 %}
                        {% set hay_quizzes = quizzes and quizzes|length > 0 %}
                        
                        {% if hay_juegos %}
                            {% for game in games %}
                            <div class="game-card">
                                <svg class="game-icon" data-lucide="gamepad-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                                <h3>{{ game.name }}</h3>
                                <p>{{ game.description }}</p>
                                <span class="game-badge">Tipo: {{ game.type|capitalize }}</span>
                                <a href="/games/{{ game.id }}" class="btn-game">Jugar Ahora</a>
                            </div>
                            {% endfor %}
                        {% endif %}
                        
                        {% if hay_quizzes %}
                            {% for quiz in quizzes %}
                            <div class="game-card">
                                <svg class="game-icon" data-lucide="clipboard-list" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                                <h3>{{ quiz.title }}</h3>
                                <p>{{ quiz.description }}</p>
                                <span class="game-badge">Área: {{ quiz.area }}</span>
                                <a href="/quiz/{{ quiz.id }}" class="btn-game">Intentar Quiz</a>
                            </div>
                            {% endfor %}
                        {% endif %}
                        
                        {% if not hay_juegos and not hay_quizzes %}
                            <div class="empty-state">
                                <svg class="empty-icon" data-lucide="inbox" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                                <p class="empty-text">No hay juegos ni quizzes disponibles aún.</p>
                                <p class="empty-subtext">Los docentes pronto agregarán contenido educativo.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Quiz Game -->
                <div id="quiz-game" class="quiz-container hidden">
                    <div class="quiz-header">
                        <h2>Quiz Programación</h2>
                        <p>Pregunta <span id="question-number">1</span> de 20 | Puntos: <span id="quiz-score">0</span></p>
                    </div>

                    <div id="quiz-question-area">
                        <div class="quiz-question">
                            <h3 id="quiz-question-text">¿Cuál es la salida del siguiente código?</h3>
                        </div>
                        
                        <div class="quiz-options" id="quiz-options-container">
                            <!-- Options populated by JS -->
                        </div>

                        <button class="btn-game" onclick="backToGames()">Volver a Juegos</button>
                    </div>

                    <div id="quiz-completed" class="hidden" style="text-align: center; padding: 2rem; background: var(--white); border-radius: 10px;">
                        <h2 style="color: var(--primary-color); font-size: clamp(1.5rem, 4vw, 2rem);">¡Quiz Completado!</h2>
                        <p style="margin: 1rem 0; color: var(--text-gray); font-size: clamp(0.9rem, 2vw, 1rem);">Puntuación final: <span id="final-quiz-score">0</span>/100</p>
                        <p style="margin: 1rem 0; color: #059669; font-size: clamp(0.9rem, 2vw, 1rem);">+<span id="quiz-xp">30</span> XP ganados</p>
                        <button class="btn-game" onclick="backToGames()">Volver a Juegos</button>
                    </div>
                </div>

                <!-- Memory Game -->
                <div id="memory-game-container" class="quiz-container hidden">
                    <div class="quiz-header">
                        <h2>Memorama de Código</h2>
                        <p>Pares encontrados: <span id="pairs-found">0</span>/8 | Intentos: <span id="attempts">0</span></p>
                    </div>

                    <div class="memory-board" id="memory-board">
                        <!-- Memory cards populated by JS -->
                    </div>

                    <div style="text-align: center;">
                        <button class="btn-game" onclick="backToGames()">Volver a Juegos</button>
                    </div>

                    <div id="memory-completed" class="hidden" style="text-align: center; margin-top: 2rem; padding: 1.5rem; background: var(--white); border-radius: 10px;">
                        <h2 style="color: var(--primary-color); font-size: clamp(1.5rem, 4vw, 2rem);">¡Memorama Completado!</h2>
                        <p style="margin: 1rem 0; color: var(--text-gray);">Completado en <span id="memory-attempts">0</span> intentos</p>
                        <p style="margin: 1rem 0; color: #059669;">+20 XP ganados</p>
                    </div>
                </div>
            </div>

            <!-- VR Lab Tab -->
            <div id="vr-tab" class="tab-content">
                    <div style="margin-bottom: 2rem;">
                    <h2 style="color: #ffffff; font-size: clamp(1.8rem, 5vw, 2.2rem); margin-bottom: 0.5rem;">Laboratorio de Realidad Virtual</h2>
                    <p style="color: #ffffff; font-size: clamp(0.9rem, 2vw, 1rem);">Explora conceptos de programación en experiencias inmersiva. Próximamente en la versión exclusiva para donadores. </p>
                </div>
                
                <div class="vr-grid">
                    <div class="vr-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <svg class="game-icon" data-lucide="link" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                            <span style="background: linear-gradient(135deg, rgba(106, 44, 61, 0.2), rgba(138, 66, 85, 0.2)); color: var(--primary-color); padding: 0.35rem 0.85rem; border-radius: 9999px; font-size: 0.8rem; font-weight: 600;">Estructuras</span>
                        </div>
                        <h3>Estructuras de Datos</h3>
                        <p>Visualiza listas enlazadas, árboles y grafos en 3D</p>
                        <button class="btn-vr" onclick="startVRExperience('structures')">
                            Iniciar Experiencia
                        </button>
                    </div>

                    <div class="vr-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <svg class="game-icon" data-lucide="repeat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                            <span style="background: linear-gradient(135deg, rgba(106, 44, 61, 0.2), rgba(138, 66, 85, 0.2)); color: var(--primary-color); padding: 0.35rem 0.85rem; border-radius: 9999px; font-size: 0.8rem; font-weight: 600;">Algoritmos</span>
                        </div>
                        <h3>Algoritmos de Ordenamiento</h3>
                        <p>Observa cómo funcionan los algoritmos de forma visual</p>
                        <button class="btn-vr" onclick="startVRExperience('algorithms')">
                            Iniciar Experiencia
                        </button>
                    </div>

                    <div class="vr-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <svg class="game-icon" data-lucide="palette" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                            <span style="background: linear-gradient(135deg, rgba(106, 44, 61, 0.2), rgba(138, 66, 85, 0.2)); color: var(--primary-color); padding: 0.35rem 0.85rem; border-radius: 9999px; font-size: 0.8rem; font-weight: 600;">Programación</span>
                        </div>
                        <h3>Paradigmas de Programación</h3>
                        <p>Explora programación orientada a objetos y funcional</p>
                        <button class="btn-vr" onclick="startVRExperience('paradigms')">
                            Iniciar Experiencia
                        </button>
                    </div>
                </div>

                <!-- VR Experience View -->
                <div id="vr-experience" class="quiz-container hidden">
                    <div style="text-align: center; padding: clamp(1.5rem, 5vw, 2.5rem);">
                        <svg style="width: 80px; height: 80px; color: var(--primary-color); margin: 0 auto 1rem; display: block;" data-lucide="headphones" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                        <h2 id="vr-title" style="color: var(--primary-color); font-size: clamp(1.5rem, 4vw, 2rem);">Cargando Experiencia VR...</h2>
                        <p id="vr-description" style="margin: 1rem 0; color: var(--text-gray); font-size: clamp(0.85rem, 2vw, 0.95rem);"></p>
                        <div style="margin: 2rem 0;">
                            <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid rgba(106, 44, 61, 0.2); border-top: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        </div>
                        <button class="btn-game" onclick="exitVR()">Salir de VR</button>
                    </div>
                </div>
            </div>

            <!-- Chat Tab -->
            <div id="chat-tab" class="tab-content">
                <div class="chat-container">
                    <div class="chat-header">
                        <svg style="width: 40px; height: 40px; background: var(--white); padding: 0.5rem; border-radius: 50%; margin-right: 0.75rem; color: var(--primary-color);" data-lucide="bot" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                        <div>
                            <h3 style="font-size: clamp(1rem, 2vw, 1.1rem); margin-bottom: 0.2rem;">Ideas de Juegos para Programar</h3>
                            <p style="font-size: clamp(0.75rem, 2vw, 0.85rem); opacity: 0.85;">Pregunta sobre juegos que puedes crear</p>
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chat-messages">
                        <div class="message bot">
                            <div class="message-bubble bot">
                                ¡Hola! Aquí puedes preguntarme sobre juegos que puedes crear para practicar programación. Ejemplo: "¿Qué juegos puedo hacer?", "Dame ideas de juegos sencillos", etc.
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input">
                        <input type="text" id="chat-input" placeholder="Pregunta sobre juegos para programar..." onkeypress="if(event.key==='Enter') sendMessage()">
                        <button class="send-button" onclick="sendMessage()">
                            <svg style="width: 20px; height: 20px;" data-lucide="send" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Quick Challenge Modal -->
    <div id="challenge-modal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); align-items: center; justify-content: center; z-index: 1001;">
        <div style="background: var(--white); border-radius: 15px; padding: 2rem; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(106, 44, 61, 0.2);">
            <h2 style="color: var(--primary-color); margin-bottom: 1rem; font-size: 1.5rem;">Desafío Rápido</h2>
            <p id="challenge-text" style="color: var(--text-gray); margin-bottom: 1.5rem; font-size: 1rem; min-height: 60px;"></p>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <input type="text" id="challenge-input" placeholder="Escribe tu respuesta..." style="width: 100%; border: 2px solid rgba(106, 44, 61, 0.2); border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; box-sizing: border-box;" onkeypress="if(event.key==='Enter') submitChallenge()">
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button onclick="closeChallenge()" style="background: rgba(106, 44, 61, 0.1); color: var(--primary-color); border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">Cancelar</button>
                    <button onclick="submitChallenge()" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">Enviar</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="main-footer">
        <p>&copy; 2025 MenTora - Todos los derechos reservados.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            updateDashboard();
        });

        let gameState = {
            level: 12,
            xp: 2450,
            streak: 7,
            points: 1250,
            currentQuiz: 0,
            quizScore: 0,
            memoryPairs: 0,
            memoryAttempts: 0,
            memoryCards: [],
            flippedCards: []
        };

        const quizQuestions = [
            {
                question: "¿Cuál es la salida de: console.log(typeof 'Programación')?",
                options: ["number", "string", "object", "undefined"],
                correct: 1
            },
            {
                question: "¿Cuál es el operador para exponenciación en JavaScript?",
                options: ["/", "*", "**", "^"],
                correct: 2
            },
            {
                question: "¿Qué es una variable en programación?",
                options: ["Un navegador", "Un contenedor de datos", "Un error", "Una función"],
                correct: 1
            },
            {
                question: "¿Cuántos tipos de datos primitivos hay en JavaScript?",
                options: ["3", "5", "7", "9"],
                correct: 2
            },
            {
                question: "¿Cuál es la estructura para iterar en Python?",
                options: ["while", "for", "foreach", "loop"],
                correct: 1
            },
            {
                question: "¿Qué es un algoritmo?",
                options: ["Un tipo de dato", "Un conjunto de pasos para resolver un problema", "Una librería", "Una base de datos"],
                correct: 1
            },
            {
                question: "¿Cuál es el índice inicial de un array en JavaScript?",
                options: ["1", "0", "-1", "variable"],
                correct: 1
            },
            {
                question: "¿Qué significa HTML?",
                options: ["High Tech Markup Language", "HyperText Markup Language", "Home Tool Markup Language", "Hyperlinks and Text Markup Language"],
                correct: 1
            },
            {
                question: "¿Cuál es la sentencia para crear una función en JavaScript?",
                options: ["Function", "func", "def", "function"],
                correct: 3
            },
            {
                question: "¿Qué es un bucle infinito?",
                options: ["Un error", "Un bucle que nunca termina", "Un tipo de array", "Una función especial"],
                correct: 1
            },
            {
                question: "¿Cuál es la diferencia entre let y const en JavaScript?",
                options: ["No hay diferencia", "let es más rápido", "const no puede ser reasignado", "const es obsoleto"],
                correct: 2
            },
            {
                question: "¿Qué es una función flecha en JavaScript?",
                options: ["Una función especial para gráficos", "Una sintaxis concisa para funciones", "Un tipo de bucle", "Un método de array"],
                correct: 1
            },
            {
                question: "¿Cuál es la salida de: console.log([] === [])?",
                options: ["true", "false", "undefined", "error"],
                correct: 1
            },
            {
                question: "¿Qué es la programación orientada a objetos (POO)?",
                options: ["Un tipo de lenguaje", "Un paradigma basado en objetos", "Una librería", "Una función especial"],
                correct: 1
            },
            {
                question: "¿Cuál es el método para agregar un elemento al final de un array?",
                options: ["add()", "push()", "append()", "insert()"],
                correct: 1
            },
            {
                question: "¿Qué es una clase en programación?",
                options: ["Un archivo", "Un blueprint para crear objetos", "Una función", "Un tipo de error"],
                correct: 1
            },
            {
                question: "¿Cuál es el resultado de: console.log(typeof null)?",
                options: ["null", "object", "undefined", "error"],
                correct: 1
            },
            {
                question: "¿Qué es la recursión?",
                options: ["Un bucle", "Cuando una función se llama a sí misma", "Un tipo de dato", "Un error común"],
                correct: 1
            },
            {
                question: "¿Cuál es la complejidad temporal de una búsqueda lineal?",
                options: ["O(1)", "O(n)", "O(n²)", "O(log n)"],
                correct: 1
            }
        ];

        const memoryCardSymbols = ["code", "key", "link", "bar-chart-2", "settings", "target", "smartphone", "globe"];

        const chatResponses = [
            "¡Genial! Algunos juegos para aprender programación son: Snake, Tic-Tac-Toe, y Pong. Empieza con algo simple.",
            "Te recomiendo crear un juego de adivinanza de números. Es perfecto para practicar condicionales y bucles.",
            "¿Has intentado hacer un juego de memoria como el que tenemos aquí? Te enseña sobre arrays y manipulación del DOM.",
            "El juego de la serpiente (Snake) es excelente para aprender sobre coordenadas, movimiento y colisiones.",
            "Crear un quiz como el nuestro es ideal para practicar objetos, arrays y funciones. ¡Inténtalo!",
            "Un juego de Piedra, Papel o Tijera te ayuda a entender condicionales y la interacción con el usuario.",
            "Para nivel intermedio, intenta crear un Tetris. Aprenderás sobre matrices y rotación de objetos.",
            "El juego de 2048 es perfecto para practicar lógica de grillas y algoritmos de combinación.",
            "Un simple juego de clics (Cookie Clicker) te enseña sobre eventos, contadores y almacenamiento local.",
            "Crear un Ahorcado digital es excelente para trabajar con strings, arrays y lógica de juegos.",
            "¿Qué tal un Sudoku? Te ayudará a mejorar tus habilidades con algoritmos de validación.",
            "Un juego de Tower Defense simple te introduce a los conceptos de programación orientada a objetos.",
            "El clásico Pong es genial para aprender sobre física básica, colisiones y animaciones.",
            "Intenta crear un Memory Card Game. Practicarás eventos, temporizadores y gestión de estado.",
            "Un juego de tipo runner (como Flappy Bird) te enseña sobre animación, física y detección de colisiones."
        ];

        function updateDashboard() {
            const levelDisplay = document.getElementById('level-display');
            if (levelDisplay) levelDisplay.textContent = gameState.level;
            const xpDisplay = document.getElementById('xp-display');
            if (xpDisplay) xpDisplay.textContent = gameState.xp;
            const streakDisplay = document.getElementById('streak-display');
            if (streakDisplay) streakDisplay.textContent = gameState.streak + ' días';
            const pointsDisplay = document.getElementById('points-display');
            if (pointsDisplay) pointsDisplay.textContent = gameState.points;
        }

        function addXP(amount) {
            gameState.xp += amount;
            gameState.points += amount / 2;
            const xpNeeded = gameState.level * 250;
            if (gameState.xp >= xpNeeded) {
                gameState.level++;
                gameState.xp = gameState.xp - xpNeeded;
                showNotification(`¡Nivel ${gameState.level} alcanzado!`);
            }
            updateDashboard();
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            const buttons = document.querySelectorAll('.filter-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function startQuiz() {
            document.getElementById('games-menu').classList.add('hidden');
            document.getElementById('quiz-game').classList.remove('hidden');
            gameState.currentQuiz = 0;
            gameState.quizScore = 0;
            showQuizQuestion();
        }

        function showQuizQuestion() {
            const question = quizQuestions[gameState.currentQuiz];
            document.getElementById('question-number').textContent = gameState.currentQuiz + 1;
            document.getElementById('quiz-score').textContent = gameState.quizScore;
            document.getElementById('quiz-question-text').textContent = question.question;
            const optionsContainer = document.getElementById('quiz-options-container');
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const button = document.createElement('div');
                button.className = 'quiz-option';
                button.textContent = option;
                button.onclick = () => selectQuizAnswer(index);
                optionsContainer.appendChild(button);
            });
        }

        function selectQuizAnswer(selectedIndex) {
            const question = quizQuestions[gameState.currentQuiz];
            const options = document.querySelectorAll('#quiz-options-container .quiz-option');
            options.forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
                option.onclick = null;
            });
            if (selectedIndex === question.correct) {
                gameState.quizScore += 10;
            }
            setTimeout(() => {
                gameState.currentQuiz++;
                if (gameState.currentQuiz < quizQuestions.length) {
                    showQuizQuestion();
                } else {
                    finishQuiz();
                }
            }, 1500);
        }

        function finishQuiz() {
            document.getElementById('quiz-question-area').classList.add('hidden');
            document.getElementById('quiz-completed').classList.remove('hidden');
            document.getElementById('final-quiz-score').textContent = gameState.quizScore;
            document.getElementById('quiz-xp').textContent = Math.floor(gameState.quizScore / 3);
            addXP(Math.floor(gameState.quizScore / 3));
        }

        function startMemoryGame() {
            document.getElementById('games-menu').classList.add('hidden');
            document.getElementById('memory-game-container').classList.remove('hidden');
            gameState.memoryPairs = 0;
            gameState.memoryAttempts = 0;
            gameState.flippedCards = [];
            setupMemoryBoard();
        }

        function setupMemoryBoard() {
            const board = document.getElementById('memory-board');
            board.innerHTML = '';
            const cardPairs = [...memoryCardSymbols, ...memoryCardSymbols];
            gameState.memoryCards = cardPairs.sort(() => Math.random() - 0.5);
            gameState.memoryCards.forEach((symbolName, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.index = index;
                card.dataset.symbol = symbolName;
                card.innerHTML = '<span style="font-size: 2rem;">?</span>';
                card.onclick = () => flipMemoryCard(card, index);
                board.appendChild(card);
            });
            updateMemoryStats();
        }

        function flipMemoryCard(card, index) {
            if (card.classList.contains('flipped') || gameState.flippedCards.length >= 2) {
                return;
            }
            card.classList.add('flipped');
            const iconName = card.dataset.symbol;
            card.innerHTML = `<i data-lucide="${iconName}" style="width: 2rem; height: 2rem;"></i>`;
            lucide.createIcons();
            gameState.flippedCards.push({card, index});
            if (gameState.flippedCards.length === 2) {
                gameState.memoryAttempts++;
                setTimeout(checkMemoryMatch, 1000);
            }
        }

        function checkMemoryMatch() {
            const [first, second] = gameState.flippedCards;
            if (first.card.dataset.symbol === second.card.dataset.symbol) {
                first.card.classList.add('matched');
                second.card.classList.add('matched');
                gameState.memoryPairs++;
                if (gameState.memoryPairs === 8) {
                    finishMemoryGame();
                }
            } else {
                first.card.classList.remove('flipped');
                second.card.classList.remove('flipped');
                first.card.innerHTML = '<span style="font-size: 2rem;">?</span>';
                second.card.innerHTML = '<span style="font-size: 2rem;">?</span>';
            }
            gameState.flippedCards = [];
            updateMemoryStats();
        }

        function updateMemoryStats() {
            document.getElementById('pairs-found').textContent = gameState.memoryPairs;
            document.getElementById('attempts').textContent = gameState.memoryAttempts;
        }

        function finishMemoryGame() {
            document.getElementById('memory-completed').classList.remove('hidden');
            document.getElementById('memory-attempts').textContent = gameState.memoryAttempts;
            addXP(20);
            showNotification('¡Memorama completado! +20 XP');
        }

        function startQuickChallenge() {
            const challenges = [
                "¿Cuál es la diferencia entre let y var en JavaScript?",
                "¿Qué es un callback?",
                "¿Cuál es la complejidad temporal del ordenamiento burbuja?",
                "¿Qué es un bucle for?",
                "¿Cuál es el propósito de la palabra clave 'this' en JavaScript?",
                "¿Qué es el scope en programación?",
                "¿Cuál es la diferencia entre == y === en JavaScript?",
                "¿Qué es una promesa en JavaScript?",
                "¿Cuál es el método para eliminar un elemento de un array?",
                "¿Qué es la inyección SQL?",
                "¿Cuál es el propósito de las pruebas unitarias?",
                "¿Qué es el versionamiento semántico?",
                "¿Cuál es la diferencia entre null y undefined?",
                "¿Qué es un REST API?",
                "¿Cuál es el propósito de un try-catch?",
                "¿Qué es la programación funcional?",
                "¿Cuál es el método para encontrar un elemento en un array?",
                "¿Qué es un evento en JavaScript?",
                "¿Cuál es la diferencia entre una clase y una interfaz?",
                "¿Qué es la inmutabilidad en programación?"
            ];
            const randomChallenge = challenges[Math.floor(Math.random() * challenges.length)];
            document.getElementById('challenge-text').textContent = randomChallenge;
            document.getElementById('challenge-input').value = '';
            const modal = document.getElementById('challenge-modal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            document.getElementById('challenge-input').focus();
        }

        function submitChallenge() {
            const input = document.getElementById('challenge-input');
            const answer = input.value.trim();
            if (answer.length > 0) {
                addXP(15);
                showNotification('¡Desafío completado! +15 XP');
                closeChallenge();
            }
        }

        function closeChallenge() {
            const modal = document.getElementById('challenge-modal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
        }

        function startVRExperience(type) {
            document.querySelector('.vr-grid').classList.add('hidden');
            document.getElementById('vr-experience').classList.remove('hidden');
            const experiences = {
                'structures': {
                    title: 'Explorando Estructuras de Datos',
                    description: 'Visualizando listas enlazadas, árboles y grafos...'
                },
                'algorithms': {
                    title: 'Laboratorio Virtual de Algoritmos',
                    description: 'Ordenando elementos con diferentes técnicas...'
                },
                'paradigms': {
                    title: 'Viaje a Paradigmas de Programación',
                    description: 'Cargando conceptos de OOP y Programación Funcional...'
                }
            };
            const exp = experiences[type];
            document.getElementById('vr-title').textContent = exp.title;
            document.getElementById('vr-description').textContent = exp.description;
            setTimeout(() => {
                addXP(25);
                showNotification(`¡Experiencia VR completada! +25 XP`);
                exitVR();
            }, 5000);
        }

        function exitVR() {
            document.getElementById('vr-experience').classList.add('hidden');
            document.querySelector('.vr-grid').classList.remove('hidden');
        }

        function backToGames() {
            document.getElementById('quiz-game').classList.add('hidden');
            document.getElementById('memory-game-container').classList.add('hidden');
            document.getElementById('quiz-completed').classList.add('hidden');
            document.getElementById('quiz-question-area').classList.remove('hidden');
            document.getElementById('memory-completed').classList.add('hidden');
            document.getElementById('games-menu').classList.remove('hidden');
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (message) {
                addChatMessage(message, 'user');
                input.value = '';
                setTimeout(() => {
                    const response = chatResponses[Math.floor(Math.random() * chatResponses.length)];
                    addChatMessage(response, 'bot');
                }, 1000);
            }
        }

        function addChatMessage(message, sender) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            const bubble = document.createElement('div');
            bubble.className = `message-bubble ${sender}`;
            bubble.textContent = message;
            messageDiv.appendChild(bubble);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    </script>
</body>
</html>
