<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Iniciar Sesión | MenTora</title>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@400;700&display=swap');
    body {
        margin: 0;
        font-family: 'Poppins', 'Orbitron', Arial, sans-serif;
        background: linear-gradient(120deg, #1a1a2e 0%, #16213e 100%);
        color: #e0e7ef;
        min-height: 100vh;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .navbar {
        width: 100vw;
        position: fixed;
        top: 0;
        left: 0;
        background: rgba(26,33,62,0.95);
        color: #00fff1;
        display: flex;
        align-items: center;
        justify-content: flex-start; /* Move content to the left */
        padding: 0.7rem 2.5rem;
        z-index: 10;
        border-bottom: 2px solid #00fff1;
        box-shadow: 0 2px 18px #00fff1a0;
        font-family: 'Orbitron', 'Poppins', Arial, sans-serif;
        letter-spacing: 2px;
    }
    .navbar .logo {
        font-size: 1.45rem;
        font-weight: bold;
        letter-spacing: 2px;
        color: #00fff1;
        text-shadow: 0 0 8px #00fff1, 0 0 2px #fff;
        margin-right: 1.2rem; /* Add space between logo and nav-links */
    }
    .navbar .nav-links a {
        color: #fff;
        text-decoration: none;
        margin-left: 0.5rem; /* Move button more to the left */
        font-weight: 600;
        font-family: 'Orbitron', 'Poppins', Arial, sans-serif;
        letter-spacing: 1px;
        transition: color 0.2s, text-shadow 0.2s;
    }
    .navbar .nav-links a:hover {
        color: #00fff1;
        text-shadow: 0 0 8px #00fff1;
    }
    .footer {
        width: 100vw;
        position: fixed;
        bottom: 0;
        left: 0;
        background: rgba(26,33,62,0.95);
        color: #00fff1;
        text-align: center;
        padding: 0.7rem 0;
        font-size: 1rem;
        letter-spacing: 1.5px;
        z-index: 10;
        border-top: 2px solid #00fff1;
        font-family: 'Orbitron', 'Poppins', Arial, sans-serif;
        text-shadow: 0 0 8px #00fff1;
    }
    .particles {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        pointer-events: none;
        z-index: 0;
    }
    .login-container {
        background: linear-gradient(120deg, #23243a 60%, #1a1a2e 100%);
        padding: 2.5rem 2rem 2rem 2rem;
        border-radius: 20px;
        width: 370px;
        box-shadow: 0 8px 32px #00fff133;
        border: 2px solid #00fff1;
        position: relative;
        z-index: 1;
        animation: fadeInUp 1.1s;
    }
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(40px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .alert-mentora {
        background: linear-gradient(90deg, #00fff1, #00c3ff);
        color: #1a1a2e;
        font-weight: bold;
        border-radius: 10px;
        padding: 0.8rem 1.2rem;
        margin-bottom: 1.2rem;
        text-align: center;
        box-shadow: 0 2px 12px #00fff1a0;
        animation: slideDown 1s;
        font-family: 'Orbitron', 'Poppins', Arial, sans-serif;
    }
    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    h2 {
        text-align: center;
        margin-bottom: 1.5rem;
        font-size: 2.1rem;
        letter-spacing: 2px;
        color: #00fff1;
        font-family: 'Orbitron', 'Poppins', Arial, sans-serif;
        text-shadow: 0 0 8px #00fff1;
    }
    form {
        display: flex;
        flex-direction: column;
    }
    label {
        margin-bottom: 0.3rem;
        font-weight: bold;
        color: #00fff1;
        font-family: 'Orbitron', 'Poppins', Arial, sans-serif;
    }
    input {
        padding: 0.6rem;
        margin-bottom: 1rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        background: rgba(255,255,255,0.18);
        color: #00fff1;
        box-shadow: 0 1px 4px #00fff133;
        transition: box-shadow 0.2s, border 0.2s;
        border: 1.5px solid #00fff1;
        font-family: 'Poppins', Arial, sans-serif;
    }
    input:focus {
        outline: none;
        box-shadow: 0 0 0 2px #00fff1;
        border: 2px solid #00fff1;
        background: #23243a;
        color: #fff;
    }
    button {
        padding: 0.8rem;
        background: linear-gradient(90deg, #00fff1, #00c3ff);
        color: #1a1a2e;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1rem;
        font-family: 'Orbitron', 'Poppins', Arial, sans-serif;
        letter-spacing: 1px;
        transition: background 0.3s, color 0.2s, transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 2px 12px #00fff1a0;
    }
    button:hover {
        background: linear-gradient(90deg, #00c3ff, #00fff1);
        color: #fff;
        transform: scale(1.05);
        box-shadow: 0 4px 24px #00fff1cc;
    }
    .register-link {
        text-align: center;
        margin-top: 1.2rem;
        font-size: 1rem;
        color: #00fff1;
        font-family: 'Orbitron', 'Poppins', Arial, sans-serif;
    }
    .register-link a {
        color: #00fff1;
        text-decoration: underline;
        font-weight: bold;
    }
    .register-link a:hover {
        color: #fff;
        text-shadow: 0 0 8px #00fff1;
    }
    .loader {
        border: 6px solid #f3f3f3;
        border-top: 6px solid #00fff1;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    @keyframes glow {
        from { text-shadow: 0 0 12px #00fff1, 0 0 2px #fff; }
        to { text-shadow: 0 0 32px #00fff1, 0 0 8px #fff; }
    }
    </style>
</head>

<body style="padding-top:60px; padding-bottom:50px;">

    <!-- Barra de navegación -->
    <nav class="navbar">
        <div class="logo" style="display:flex; align-items:center; gap:0.7rem; margin-right:1.2rem;">
            <img src="/static/img/mentora.png" alt="MenTora Logo" style="height:60px; width:60px; border-radius:50%; background:#fff; border:2px solid #00fff1; box-shadow:0 1px 4px #00fff1a0;">
            <span style="font-size:1.25rem; font-weight:bold; color:#00fff1; letter-spacing:1px;"></span>
        </div>
        <div class="nav-links">
            <a href="/">Inicio</a>
        </div>
    </nav>


    <canvas class="particles"></canvas>

    <div class="login-container">
        <div id="alert-mentora-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(44,62,80,0.55); z-index:1000; justify-content:center; align-items:center;">
            <div style="background:linear-gradient(120deg,#00fff1 0%,#16213e 100%); color:#1a1a2e; border-radius:22px; padding:2.2rem 2.5rem; box-shadow:0 4px 32px #00fff1a0, 0 0 24px #00fff1; display:flex; flex-direction:column; align-items:center; border:2.5px solid #00fff1; position:relative; overflow:hidden;">
                <div style="font-size:2.1rem; font-weight:bold; margin-bottom:1.1rem; font-family:'Orbitron','Poppins',Arial,sans-serif; color:#00fff1; letter-spacing:2px; text-shadow:0 0 12px #00fff1,0 0 2px #fff;">
                    <span style="display:inline-block; animation:glow 1.2s infinite alternate;">Entrando a MenTora</span>
                </div>
                <div style="margin-bottom:1.2rem; color:#fff; font-family:'Poppins','Orbitron',Arial,sans-serif; font-size:1.1rem; text-shadow:0 0 8px #00fff1;">¡Prepárate para aprender jugando!</div>
                <div class="loader" style="margin-bottom:0.7rem; border-top:6px solid #fff; border-right:6px solid #00fff1; border-bottom:6px solid #00c3ff; border-left:6px solid #00fff1; box-shadow:0 0 16px #00fff1;"></div>
                <div style="font-size:1.1rem; color:#fab005; font-family:'Orbitron','Poppins',Arial,sans-serif; letter-spacing:1px; text-shadow:0 0 8px #00fff1;">Cargando...</div>
                <div style="position:absolute; top:-30px; right:-30px; width:80px; height:80px; background:radial-gradient(circle,#00fff1 0%,transparent 70%); opacity:0.25;"></div>
                <div style="position:absolute; bottom:-30px; left:-30px; width:80px; height:80px; background:radial-gradient(circle,#00fff1 0%,transparent 70%); opacity:0.18;"></div>
            </div>
        </div>
    <div id="alert-error" class="alert-mentora" style="display:none; background:linear-gradient(90deg,#ff6b6b,#f06595);color:#fff;"></div>
        <h2>Iniciar Sesión</h2>
        <form id="loginForm" method="POST" action="/login" autocomplete="off">
            <label for="username">Usuario</label>
            <input type="text" id="username" name="username" required autocomplete="username">
            <label for="password">Contraseña</label>
            <input type="password" id="password" name="password" required autocomplete="current-password">
            <button type="submit" id="btnEntrar">Entrar</button>
        </form>
        <div class="register-link">
            ¿No tienes cuenta? <a href="/register">Regístrate aquí</a>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        &copy; 2025 MenTora | Aprende jugando. Todos los derechos reservados.
    </footer>

    <script>
    // Partículas animadas sutiles en el fondo
    const canvas = document.querySelector('.particles');
    const ctx = canvas.getContext('2d');
    let particles = [];
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();
    for (let i = 0; i < 32; i++) {
        particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            r: 1.5 + Math.random() * 2.5,
            dx: (Math.random() - 0.5) * 0.4,
            dy: (Math.random() - 0.5) * 0.4,
            alpha: 0.15 + Math.random() * 0.15
        });
    }
    function drawParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (const p of particles) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
            ctx.fillStyle = `rgba(255,255,255,${p.alpha})`;
            ctx.fill();
            p.x += p.dx;
            p.y += p.dy;
            if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
            if (p.y < 0 || p.y > canvas.height) p.dy *= -1;
        }
        requestAnimationFrame(drawParticles);
    }
    drawParticles();

    // Lógica de login AJAX y alertas
    const loginForm = document.getElementById('loginForm');
    const btnEntrar = document.getElementById('btnEntrar');
    const alertMentoraModal = document.getElementById('alert-mentora-modal');
    const alertError = document.getElementById('alert-error');

    loginForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        alertError.style.display = 'none';
        // Enviar login por AJAX para validar credenciales
        const formData = new FormData(loginForm);
        try {
            const response = await fetch('/login', {
                method: 'POST',
                body: formData
            });
            if (response.ok) {
                // Si la respuesta es JSON, úsala; si no, muestra error genérico
                let res;
                try {
                    res = await response.json();
                } catch (err) {
                    alertError.textContent = 'Usuario o contraseña incorrectos';
                    alertError.style.display = 'block';
                    return;
                }
                if (res.success) {
                    alertMentoraModal.style.display = 'flex';
                    setTimeout(() => {
                        window.location.href = res.redirect || '/dashboard';
                    }, 4000);
                } else {
                    alertError.textContent = res.message || 'Usuario o contraseña incorrectos';
                    alertError.style.display = 'block';
                }
            } else {
                alertError.textContent = 'Usuario o contraseña incorrectos';
                alertError.style.display = 'block';
            }
        } catch (err) {
            alertError.textContent = 'Error de conexión. Intenta de nuevo.';
            alertError.style.display = 'block';
        }
    });

    // Mostrar alerta de error si el backend lo indica (usando Flask flash)
    window.addEventListener('DOMContentLoaded', function() {
        const errorMsg = document.getElementById('login-error-msg');
        if (errorMsg) {
            alertError.textContent = errorMsg.textContent || 'Usuario o contraseña incorrectos';
            alertError.style.display = 'block';
        }
    });
    </script>
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div id="login-error-msg" style="display:none;">{{ messages[0] }}</div>
            {% endif %}
        {% endwith %}

</body>
</html>